# 📌 기본형 데이터와 참조형 데이터

기본형 데이터와 참조형 데이터에 대해 알아보고자 작성했다.  **[코어 자바스크립트]** 책을 보면서 직접 그림그리며 작성해보았다. 메모리에 할당되는 형태를 보면서 작성하니 이해에 많은 도움이 되었다. 참고로 내돈내산...

- 구매주소 : [코어자바스크립트](http://www.kyobobook.co.kr/product/detailViewKor.laf?barcode=9791158391720)



## ✅ immutable(불변성)/mutable(가변성)

값이 변동이 많으면 예기치 못한 상황을 초래할 수 있기 때문에 불변성을 보장하도록 작성하는 것이 좋음.



### 💬 불변성

불변성은 한 번 만든 값을 바꿀 수 없고, 다른 값으로 변경할 수 없는 것을 이야기 함. 변경은 새로 만드는 동작에 의해서만 이뤄진다. 이것이 바로 불변값이자, 불변값이 가지는 성질이라 할 수 있다. 자바스크립트에서 기본형 데이터는 '불변성'을 가지고 있다.



#### 📑 특징

- 원본은 변경이 없음.

- 원본을 복사하거나 새로운 객체를 생성하여 사용.

- 원본에 영향이 없으므로 안전성을 보장받을 수 있음.

- 메모리는 가변성 데이터보다 더 사용될 수 있음.

  

#### 📑 예제로 불변성 알아보기

> 불변성은 값이 존재하는 한 메모리를 재할당하는 것이 아니라, 다시 재활용(참조)하는 것이다. 그렇기때문에 가비지 컬렉팅을 하지 않는 이상 한번 만들어진 값은 영원히 변하지 않는다.



- **첫번째 상태** : 변수 'a'에 abc를 할당한다.

```js
var a = 'abc';
```

![1](https://user-images.githubusercontent.com/74591219/106860789-387c4680-6708-11eb-9136-4fbb49ec949b.png)

- **두번째 상태** : 선언된 변수 a에 'def'라는 데이터 값을 더한다.

```js
a = a + 'def';
```

![2](https://user-images.githubusercontent.com/74591219/106860791-39ad7380-6708-11eb-94a9-338271747f93.png)



### 💬 가변성

불변값과 달리 가변값을 가지는 것을 가변성이라 한다. 데이터 영역에 저장된 값은 모두 불변 값이나, 변수에는 다른 값을 대입할 수 있다. 바로 이것을 바로 불변하지 않다. 즉, 가변성이라 할 수 있다. (결국 변할 수 있는 값을 가지는 성질을 이야기하는 것이다.)



#### 📑 특징

- 어떤 작업에 의해 원본 변경이 가능한 것.

- 메모리적으로는 이득을 볼 수 있음.

- 원본이 변경되므로 원본을 참조하는 경우 주의.

  

#### 📑 예제로 불변성 알아보기

> 기본형 데이터와 다른 것은 객체의 변수 영역이 별도로 존재한다는 것. (메모리 영역에서 참조하는 또 다른 메모리 영역이 따로있다는 의미).  새로운 값을 할당하는 것은 결국 프로퍼티 내부에서 참조하고 있는 주소값을 바꾸는 것이다. 결국 이 주소 값의 변경이 가능하기 때문에 가변이 가능하다라는 의미인 것 같다. 결국 직접적 데이터와 주소간을 연결하기보다, 객체 내부에서 참조하는 주소 값을 변경하면서 값의 변경이 가능해지는 것이다.



- **첫번째 상태** : 오브젝트를 선언

```js
var obj1 = {
    a: 1,
    b: 'bbb'
}
```

![3](https://user-images.githubusercontent.com/74591219/106863830-6b283e00-670c-11eb-9650-16b49b0e295a.png)



- **두번째 상태** : 변수 obj1 오브젝트의 내부에 있는 property에 새로운 값을 할당

```js
obj1.a = 'fff'
obj2.b = '말록'
```

![4](https://user-images.githubusercontent.com/74591219/106863837-6c596b00-670c-11eb-847c-f318a08f9412.png)



### 💬 불변성과 가변성의 복사비교

개인적으로 불변성과 가변성의 차이는 Copy에서 비롯된다고 본다. 그래서 그림으로 직접 그려가며 흐름을 따라가보았다.



#### 📑 예제로 불변성과 가변성의 복사 비교하기

- **첫번째 상태** : 변수 선언 및 값 할당, 복사

```js
var a = 10;
var b = a;

var obj1 = { c: 10, d: 'ddd'};
var obj2 = obj1;
```

![5](https://user-images.githubusercontent.com/74591219/106866244-919ba880-670f-11eb-96ec-2b0865e932cd.png)



- **두번째 상태** : 선언되었던 변수에 값 재할당

  재할당 시, 참조하고 있는 값의 주소 값만 변경된다. 만약 값이 이 전에 생성되어있는 데이터 값이 있다면 새로 만들지 않고 해당 데이터 값이 저장된 주소를 할당한다. 

```js
b = 15;
obj2.c = 20;
```

![6](https://user-images.githubusercontent.com/74591219/106866250-93656c00-670f-11eb-8b36-8886b5794f33.png)



#### 📑 위의 최종 결과를 비교한다면?

- 🚀 **기본형 데이터**

```js
b = 15;

a === b //false
```

- 여기서 가장 의문이 드는 것은 a랑 b는 불변값인데 왜 값이 바뀌는 것이냐라는 것이다. 이것은 바로 참조하고 있는 주소값이 바뀌기 때문이다. **결론적으로 값이 같냐 다르냐는 내가 선언해서 사용하고 있는 변수가 '참조하고 있는 주소 값의 변경여부'**이다.

- 처음엔 a=b 를 할당하여 주소 값이 같은 상태이므로 a === b를 선언했을 때 true 값이 결과로 도출된다.

  ```js
  var a = 10
  var b = a;
  a === b // true
  ```

- 하지만 b = 15 로 값을 재할당하면 현재 참조하고 있는 주소값은 10을 가진 주소이므로 15를 가진 주솟값을 찾거나 없다면 새로 메모리를 할당하여 해당 주소값을 가지게 된다.

  ```js
  b = 15;
  a === b // false
  ```

- 만약 다시 true 값을 가지게 하고 싶다면 b에 10을 다시 할당하면 된다. 

  

- **🚀 참조형 데이터**

```js
obj2.c = 20;

obj1 === obj2 //true
```

- 위의 내용을 이해했다면 위와 같은 형태는 왜 'true'가 나오는지 알 수 있다.

- obj2 안에 새로운 c라는 변수에 20을 할당한 값을 넣어주었지만 obj1과 obj2는 true 이다.

- 이것은 obj1과 obj2 가 **참조하고 있는 데이터 영역의 주소값이 동일**하기 때문이다.

- 바로 여기서 가장 중요한 부분이(내가 느끼기에) 내가 선언한 변수가 다른 참조형 변수를 보고 있을 때, 값이 변동되면 참조하고 있는 **데이터 영역의 주소값이 동일하기 때문에 함께 값이 변동된다(!)**라는 점이다.

  ```js
  console.log(obj1); // {c: 20, d: "ddd"}
  console.log(obj2); // {c: 20, d: "ddd"}
  
  obj2.g = "추가";
  
  console.log(obj1) // {c: 20, d: "ddd", g: "추가"}
  console.log(obj2) // {c: 20, d: "ddd", g: "추가"}
  ```

- obj1에 property를 추가 한 것이 아니라, obj2에 property를 추가 했지만 obj1에도 obj2에서 추가했던 부분이 출력된다.

  

>결론적으로 모든 값은 불변이자, 참조 값이다. 결국은 상수가 아니라, 모두가 변수로 작동되기 때문이다. 값은 '불변'이지만 대응되는 주소 값이 달라지고, 달라지지 않고가 바로 자바스크립트에서 사용되는 불변과 가변의 핵심이다.

```js
obj2 = {c: 20, d: "ddd", g: "추가"}

console.log(obj1) // {c: 20, d: "ddd", g: "추가"}
console.log(obj2) // {c: 20, d: "ddd", g: "추가"}

obj1 === obj2 // false
```

- 자바스크립트에서 object는 일반적으로 new Object()와 동일하게 동작하므로 이것은 메모리에 새롭게 할당되는 동작이다.

- 그렇다면 새로 할당된 object는 또 다른 메모리 공간을 필요하게 될 것이다. 

- 이때, obj2가 참조하고 있는 주소 값 자체가 새로운 오브젝트의 주소 값으로 덮어씌워지므로 obj2는 결과적으로 obj1과는 다른 값을 가지는 것으로 판단하게 된다.

- 내부의 값 기준이 아닌, 주소 값이 기준이기 때문이다. **값은 불변하지만, 참조하는 주소값은 불변하지 않다.**

  

### 💬 불변성은 어떨 때 사용할까